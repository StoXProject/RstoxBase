<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Weighting of biotic hauls in biotic assignment — BioticAssignmentWeighting • RstoxBase</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Weighting of biotic hauls in biotic assignment — BioticAssignmentWeighting"><meta property="og:description" content="This function puts weights to the hauls assigned to acoustic PSUs in BioticAssignment process data."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">RstoxBase</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.11.0-9001</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/StoXProject/RstoxBase/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Weighting of biotic hauls in biotic assignment</h1>
    <small class="dont-index">Source: <a href="https://github.com/StoXProject/RstoxBase/blob/HEAD/R/Define.R" class="external-link"><code>R/Define.R</code></a></small>
    <div class="hidden name"><code>BioticAssignmentWeighting.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This function puts weights to the hauls assigned to acoustic PSUs in <code><a href="BioticAssignment.html">BioticAssignment</a></code> process data.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">BioticAssignmentWeighting</span><span class="op">(</span></span>
<span>  <span class="va">BioticAssignment</span>,</span>
<span>  WeightingMethod <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Equal"</span>, <span class="st">"NumberOfLengthSamples"</span>, <span class="st">"NormalizedTotalWeight"</span>,</span>
<span>    <span class="st">"NormalizedTotalNumber"</span>, <span class="st">"SumWeightedNumber"</span>, <span class="st">"InverseSumWeightedNumber"</span>,</span>
<span>    <span class="st">"AcousticDensity"</span><span class="op">)</span>,</span>
<span>  <span class="va">StoxBioticData</span>,</span>
<span>  <span class="va">LengthDistributionData</span>,</span>
<span>  MaxNumberOfLengthSamples <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  <span class="va">NASCData</span>,</span>
<span>  LayerDefinition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"FunctionParameter"</span>, <span class="st">"FunctionInput"</span><span class="op">)</span>,</span>
<span>  LayerDefinitionMethod <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"WaterColumn"</span>, <span class="st">"HighestResolution"</span>, <span class="st">"Resolution"</span>, <span class="st">"Table"</span><span class="op">)</span>,</span>
<span>  Resolution <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/double.html" class="external-link">double</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  LayerTable <span class="op">=</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  AcousticLayer <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">AcousticPSU</span>,</span>
<span>  <span class="va">AcousticTargetStrength</span>,</span>
<span>  SpeciesLink <span class="op">=</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  Radius <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/double.html" class="external-link">double</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  MinNumberOfEDSUs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">integer</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>BioticAssignment</dt>
<dd><p>The <code><a href="BioticAssignment.html">BioticAssignment</a></code> process data.</p></dd>


<dt>WeightingMethod</dt>
<dd><p>Character: A string naming the method to use, one of "Equal", giving weight 1 to all Hauls; "NumberOfLengthSamples", weighting hauls by the number of length samples; "AcousticDensity", weighting by the surrounding NASC converted by the haul length distribution to an acoustic density equivalent; "NormalizedTotalWeight", weighting hauls by the total weight of the catch, normalized by dividing by towed distance; "NormalizedTotalNumber", the same as "NormalizedTotalWeight" but for total number, "SumWeightedNumber", weighting by the summed WeightedNumber of the input LengthDistributionData; and "InverseSumWeightedNumber", weighting by the inverse of the summed WeightedNumber.</p></dd>


<dt>StoxBioticData</dt>
<dd><p>The <code><a href="https://rdrr.io/pkg/RstoxData/man/StoxBioticData.html" class="external-link">StoxBioticData</a></code> data (defined in RstoxData).</p></dd>


<dt>LengthDistributionData</dt>
<dd><p>The LengthDistributionData of LengthDistributionType "Standard" or "Normalized", used for WeightingMethod = "SumWeightedNumber" or "InverseSumWeightedNumber", in which case the column WeightedNumber is summed in each Haul (summed over all length groups, which implies that the resolution of length intervals does not matter).</p></dd>


<dt>MaxNumberOfLengthSamples</dt>
<dd><p>For <code>WeightingMethod</code> = "NumberOfLengthSamples": Values of the number of length samples that exceed <code>MaxNumberOfLengthSamples</code> are set to <code>MaxNumberOfLengthSamples</code>. This avoids giving too high weight to e.g. experimental hauls with particularly large length samples.</p></dd>


<dt>NASCData</dt>
<dd><p>The <code><a href="NASCData.html">NASCData</a></code> data.</p></dd>


<dt>LayerDefinition</dt>
<dd><p>The method to use for defining the Layers, one of <code>FunctionParameter</code> to define the Layers on the fly in this function, <code>FunctionInput</code> to import Layer process data from a previously run process using the function <code>DefineAcousticLayer</code>, or <code>PreDefined</code> whihc requires <code>SumNASCData</code> as input.</p></dd>


<dt>LayerDefinitionMethod</dt>
<dd><p>See <code><a href="DefineAcousticLayer.html">DefineAcousticLayer</a></code></p></dd>


<dt>Resolution</dt>
<dd><p>Numeric: A single numeric giving the thickness of the layers.</p></dd>


<dt>LayerTable</dt>
<dd><p>A table of Layer name, MinLayerDepth in meters and MaxLayerDepth in meters, defining the Layers.</p></dd>


<dt>AcousticLayer</dt>
<dd><p>The <code><a href="AcousticLayer.html">AcousticLayer</a></code> process data.</p></dd>


<dt>AcousticPSU</dt>
<dd><p>The <code><a href="AcousticPSU.html">AcousticPSU</a></code> process data.</p></dd>


<dt>AcousticTargetStrength</dt>
<dd><p>The <code><a href="AcousticTargetStrength.html">AcousticTargetStrength</a></code> process data.</p></dd>


<dt>SpeciesLink</dt>
<dd><p>A table of the two columns AcousticCategory and SpeciesCategory.</p></dd>


<dt>Radius</dt>
<dd><p>For <code>WeightingMethod</code> = "AcousticDensity": The radius (nautical miles) inside which the average AcousticDensity is calculated.</p></dd>


<dt>MinNumberOfEDSUs</dt>
<dd><p>For <code>WeightingMethod</code> = "AcousticDensity": The minimum number of EDSUs to link to each Haul, applied if there are less than <code>MinNumberOfEDSUs</code> EDSUs inside the <code>Radius</code>. This can be used to avoid the warning for "no positive NASC inside the specified radius", but only if the NASCData input does not contain EDSUs with no positive NASC for the target species. <code>FilterStoxAcoustic</code> can be used to filter out EDSUs with no positive NASC. It can also happen that the LengthDistributionData contains Hauls with no length distribution for the target species, also resulting in the warning. This can also be solved by filtering. It is in fact recommended to only keep Hauls with the target species in acoustic-trawl models.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>An object of StoX data type <code><a href="BioticAssignment.html">BioticAssignment</a></code>.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>The <em>BioStationWeighting</em> function is used to update the weighting variables of the biotic stations that are associated in <code><a href="BioticAssignment.html">BioticAssignment</a></code>. The list of assigned biotic hauls and weighting variables of an assignment, will in another function be used to make a total combined length frequency distribution from all the individual haul distributions.</p>
<p>A set of automatic <em>WeightingMethod</em>s are available to update the haul weighing variables. Note that the weighting may change if an additional species is included for all WeightingMethods except "Equal":</p>
<p><strong>Equal</strong></p>
<p>All assigned biotic hauls are given equal weight by assigning the value 1 to the weighting variables.</p>
<p><strong>NumberOfLengthSamples</strong>
The assigned biotic hauls are given a weighting value according to the number of individual length samples of the target species at the biotic station. The parameter <em>MaxNumberOfLengthSamples</em> is also associated with this method and is used to limit the weighting to a maximum number of length samplesof a haul. Note that the weighting may change if an additional species is included.</p>
<p><strong>NormalizedTotalWeight</strong></p>
<p>The assigned biotic hauls are given a weighting value according to the normalized catch weight of the target species at the station. The weighting value is calculated as catch weight divided by towing distance. This normalization makes the stations comparable regardless of catch effort.</p>
<p><strong>NormalizedTotalNumber</strong></p>
<p>The assigned biotic hauls are given a weighting value according to the normalized catch number (number of individuals) of the target species at the biotic station. The weighting value is calculated as catch number divided by towing distance. This normalization makes the stations comparable regardless of catch effort.</p>
<p><strong>SumWeightedNumber</strong></p>
<p>The assigned biotic hauls are given a weighting value according to the sum of the WeightedNumber of the target species at the biotic station. It is a requirement that the lengthdistribution data is of distribution type <em>Standard</em> or <em>Normalized</em> (normalized to one nautical mile towing distance).</p>
<p><strong>InverseSumWeightedNumber</strong></p>
<p>The assigned biotic hauls are given a weighting value as the inverse of the sum of the WeightedNumber of all length groups and all species. The weighting value \(w_b\) is calculated as:</p>
<p>$$w_b = \frac{1}{\sum_{s_b}^{n_b} \sum_{l=1}^{m_{s,b}} c_{l,s,b} }$$</p>
<p>where:</p>
<p>\(w_b\) = weighting value of biotic haul <em>b</em></p>
<p>\(s_b\) = species in the biotic haul <em>b</em></p>
<p>\(n_b\) = number of species in the input data of biotic haul <em>b</em></p>
<p>\(l\) =  length group number</p>
<p>\(m_{s,b}\)  =	number of length groups for species <em>s</em> in biotic haul <em>b</em></p>
<p>\(c_{l,s,b}\) = number in length group <em>l</em> for species <em>s</em> in biotic haul <em>b</em></p>
<p>The method is commonly used in split NASC (nautical area scattering coefficient) models to split an acoustic category of several species by using the length distributions of the these species. The sum of the splitted NASC values of all the species will be equal to the NASC of the original combined acoustic multispecies category. By multiplying the calculated weighting value from this method, by the original (input) numbers in each length group for all species, a relative station length distribution can later be made (sum of length groups for all species is 1) and used in the split NASC process.</p>
<p>It is a requirement that the LengthDistribution Data is of distribution type <em>Standard</em> or <em>Normalized</em> (normalized to one nautical mile towing distance).</p>
<p><strong>AcousticDensity</strong></p>
<p>The assigned biotic hauls are given weighting variable values with the basis in the surrounding NASC values that are tagged to an acoustic PSU. By combining these NASC values with the length distribution of the biotic haul, an acoustic density as number of fish per square nautical mile is calculated and used as the weighting variable value for each biotic haul.</p>
<p>A search for NASC values (at EDSU resolution) is performed within a given radius around a biotic station. For each EDSU inside the radius the length distribution of the biotic station and a target strength (TS) versus length empirical relationship is used to calculate acoustic density for each length group and beam. The sum of densities (number per square nautical mile) over all length groups of the target species at the given biotic haul is then calculated and applied as the weighting variable for the biotic haul.</p>
<p>The AcousticDensity WeightingMethod is associated with the following function inputs and parameters:</p>
<p><em>AcousticTargetStrength</em>: The acoustic target strength model and parameters, defined by <code><a href="DefineAcousticTargetStrength.html">DefineAcousticTargetStrength</a></code></p>
<p><em>SpeciesLink</em>: The table linking the AcousticCategory and SpeciesCategory.</p>
<p><em>Radius</em>: Search radius (nautical miles) for NASC values (at EDSU resolution) around a biotic station</p>
<p><em>MinNumberOfEDSUs</em> The minimum number of EDSUs to use, effectively expanding the radius to cover this number of EDSUs if an insufficient number of EDSUs is found using the specified radius</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="DefineBioticAssignment.html">DefineBioticAssignment</a></code> for generating BioticAssignment.</p></div>
    </div>

  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Arne Johannes Holmin, Ibrahim Umar, Sindre Vatnehol, Edvin Fuglebakk, Aasmund Skaalevik, Esmael Musema Hassen, Espen Johnsen, Atle Totland, Norwegian Institute of Marine Research.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.9000.</p>
</div>

      </footer></div>

  


  

  </body></html>

